---
import BaseLayout from '../../components/layout/BaseLayout.astro';
import CurrentConditions from '../../components/forecast/CurrentConditions';
import SportsMetrics from '../../components/forecast/SportsMetrics';
import HourlyForecast from '../../components/forecast/HourlyForecast';
import DailyForecast from '../../components/forecast/DailyForecast';
import { venues, getVenueById } from '../../lib/venue-data';
import { getForecast } from '../../lib/weather-queries';
import type { Venue } from '../../lib/types';

export const prerender = false;

const { venue: venueId } = Astro.params;
const venue = getVenueById(venueId || '');

if (!venue) {
  return Astro.redirect('/venues');
}

const forecast = await getForecast(venue.lat, venue.lon, 15);
const sportType = venue.sport === 'multi' ? 'youth' : venue.sport;
---

<BaseLayout
  title={venue.name}
  description={`Live weather forecast for ${venue.name} in ${venue.city}, ${venue.state}. Current: ${forecast.current.tempF}Â°F, ${forecast.current.description}.`}
>
  <div class="mx-auto max-w-7xl px-4 py-6">
    <div class="mb-6">
      <nav class="text-sm text-text-muted dark:text-text-dark-muted">
        <a href="/" class="hover:text-field">Home</a>
        <span class="mx-2">/</span>
        <a href="/venues" class="hover:text-field">Venues</a>
        <span class="mx-2">/</span>
        <span>{venue.name}</span>
      </nav>
    </div>

    <!-- Venue header -->
    <div class="mb-6 rounded-xl border border-border bg-surface p-6 shadow-sm dark:border-border-dark dark:bg-surface-dark-alt">
      <div class="flex flex-wrap items-start justify-between gap-4">
        <div>
          <h1 class="text-2xl font-bold text-text dark:text-text-dark">{venue.name}</h1>
          <p class="mt-1 text-text-muted dark:text-text-dark-muted">
            {venue.city}, {venue.state}
          </p>
          <div class="mt-3 flex flex-wrap gap-2">
            <span class="rounded-full bg-field/10 px-3 py-1 text-sm font-medium capitalize text-field-dark">{venue.sport}</span>
            <span class="rounded-full bg-surface-alt px-3 py-1 text-sm font-medium capitalize text-text-muted dark:bg-surface-dark dark:text-text-dark-muted">{venue.type}</span>
            {venue.capacity > 0 && (
              <span class="rounded-full bg-surface-alt px-3 py-1 text-sm font-medium text-text-muted dark:bg-surface-dark dark:text-text-dark-muted">
                {venue.capacity.toLocaleString()} capacity
              </span>
            )}
          </div>
        </div>
        <a
          href={`/game-planner?lat=${venue.lat}&lon=${venue.lon}`}
          class="rounded-lg bg-field px-4 py-2 text-sm font-semibold text-white transition-colors hover:bg-field-dark"
        >
          Plan Game Here
        </a>
      </div>
    </div>

    <div class="grid gap-6 lg:grid-cols-3">
      <div class="space-y-6 lg:col-span-2">
        <CurrentConditions client:only="react" current={forecast.current} locationName={venue.name} />
        <HourlyForecast client:only="react" hourly={forecast.hourly} />
      </div>
      <div class="space-y-6">
        <SportsMetrics client:only="react" forecast={forecast.current} defaultSport={sportType} />
        <DailyForecast client:only="react" daily={forecast.daily} />
      </div>
    </div>
  </div>
</BaseLayout>
