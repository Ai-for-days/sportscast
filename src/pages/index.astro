---
import BaseLayout from '../components/layout/BaseLayout.astro';
import Card from '../components/ui/Card.astro';

export const prerender = true;

const features = [
  {
    icon: 'ğŸ“Š',
    title: 'Sports Playability',
    description: 'Sport-specific playability scores, heat index, wind chill, and safety recommendations.',
    href: '/forecast/34.0007,-81.0348',
  },
  {
    icon: 'ğŸ—ºï¸',
    title: 'Weather Map',
    description: 'Interactive map with temperature, precipitation, and wind overlays across the US.',
    href: '/map',
  },
  {
    icon: 'ğŸŸï¸',
    title: 'Venue Forecasts',
    description: 'Live weather for 300+ stadiums and venues â€” MLB, NFL, NCAA, MLS, and community fields.',
    href: '/venues',
  },
  {
    icon: 'ğŸ“ˆ',
    title: '15-Day Forecast',
    description: 'Extended forecasts at 0.25Â° resolution powered by Google DeepMind WeatherNext 2.',
    href: '/forecast/34.0007,-81.0348',
  },
  {
    icon: 'ğŸ“…',
    title: 'Historical Lookup',
    description: 'What was the weather at any venue on any date? Compare to seasonal averages.',
    href: '/historical',
  },
];
---

<BaseLayout title="Sports Weather Intelligence">
  <!-- Hero -->
  <section class="relative overflow-hidden bg-gradient-to-br from-field-dark via-field to-sky px-4 py-20 text-white">
    <div class="absolute inset-0 bg-[radial-gradient(circle_at_30%_40%,rgba(255,255,255,0.1),transparent)]"></div>
    <div class="relative mx-auto max-w-4xl text-center">
      <h1 class="text-4xl font-bold tracking-tight sm:text-5xl md:text-6xl">
        Weather Intelligence<br />for Sports
      </h1>
      <p class="mx-auto mt-4 max-w-2xl text-lg text-white/80 sm:text-xl">
        Powered by Google DeepMind's WeatherNext 2. 15-day forecasts with 64-member ensemble analysis,
        sport-specific playability scores, and game-day recommendations.
      </p>
      <div class="mt-8 flex flex-col items-center gap-4 sm:flex-row sm:justify-center">
        <a href="/forecast/34.0007,-81.0348" class="rounded-lg bg-white px-6 py-3 text-sm font-semibold text-field-dark shadow-lg transition-transform hover:scale-105">
          Get Forecast
        </a>
        <a href="/venues" class="rounded-lg border-2 border-white/30 px-6 py-3 text-sm font-semibold text-white backdrop-blur-sm transition-colors hover:bg-white/10">
          Browse Venues
        </a>
      </div>
    </div>
  </section>

  <!-- Quick search -->
  <section class="mx-auto -mt-8 max-w-2xl px-4">
    <div class="rounded-xl border border-border bg-surface p-4 shadow-xl dark:border-border-dark dark:bg-surface-dark-alt" id="search-container">
      <form id="search-form" class="flex gap-2" action="/forecast/" method="get">
        <div class="relative flex-1">
          <svg class="pointer-events-none absolute left-3 top-1/2 h-5 w-5 -translate-y-1/2 text-text-muted" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
          </svg>
          <input
            type="text"
            id="search-input"
            placeholder="Search city, stadium, or zip code..."
            class="w-full rounded-lg border border-border bg-surface py-3 pl-10 pr-4 text-sm outline-none focus:border-field focus:ring-2 focus:ring-field/20 dark:border-border-dark dark:bg-surface-dark dark:text-text-dark"
          />
        </div>
        <button type="submit" class="rounded-lg bg-field px-6 py-3 text-sm font-semibold text-white transition-colors hover:bg-field-dark">
          Search
        </button>
      </form>
    </div>
  </section>

  <script>
    const form = document.getElementById('search-form') as HTMLFormElement;
    const input = document.getElementById('search-input') as HTMLInputElement;

    form?.addEventListener('submit', async (e) => {
      e.preventDefault();
      const q = input.value.trim();
      if (!q) return;

      // Try to geocode
      try {
        const res = await fetch(`/api/geocode?q=${encodeURIComponent(q)}`);
        if (res.ok) {
          const results = await res.json();
          if (results.length > 0) {
            window.location.href = `/forecast/${results[0].lat},${results[0].lon}`;
            return;
          }
        }
      } catch {}
      alert('Location not found. Try a different search term.');
    });
  </script>

  <!-- Features grid -->
  <section class="mx-auto max-w-7xl px-4 py-16">
    <h2 class="mb-8 text-center text-2xl font-bold text-text dark:text-text-dark">Everything You Need for Game Day</h2>
    <div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
      {features.map(feature => (
        <a href={feature.href} class="group">
          <Card class="h-full transition-shadow hover:shadow-md">
            <div class="text-3xl">{feature.icon}</div>
            <h3 class="mt-3 text-lg font-semibold text-text group-hover:text-field dark:text-text-dark dark:group-hover:text-field-light">
              {feature.title}
            </h3>
            <p class="mt-2 text-sm text-text-muted dark:text-text-dark-muted">
              {feature.description}
            </p>
          </Card>
        </a>
      ))}
    </div>
  </section>

  <!-- Data source highlight -->
  <section class="border-t border-border bg-surface-alt px-4 py-16 dark:border-border-dark dark:bg-surface-dark-alt">
    <div class="mx-auto max-w-4xl text-center">
      <h2 class="text-2xl font-bold text-text dark:text-text-dark">Powered by WeatherNext 2</h2>
      <p class="mx-auto mt-4 max-w-2xl text-text-muted dark:text-text-dark-muted">
        Google DeepMind's WeatherNext 2 uses machine learning trained on decades of ERA5 reanalysis data to produce
        15-day forecasts at 0.25-degree resolution (~28km). With 64 ensemble members, you get probability ranges â€”
        not just single-point predictions.
      </p>
      <div class="mt-8 grid gap-6 sm:grid-cols-3">
        <div>
          <div class="text-3xl font-bold text-field">15 days</div>
          <div class="mt-1 text-sm text-text-muted dark:text-text-dark-muted">Forecast range</div>
        </div>
        <div>
          <div class="text-3xl font-bold text-sky">64</div>
          <div class="mt-1 text-sm text-text-muted dark:text-text-dark-muted">Ensemble members</div>
        </div>
        <div>
          <div class="text-3xl font-bold text-storm">0.25Â°</div>
          <div class="mt-1 text-sm text-text-muted dark:text-text-dark-muted">Spatial resolution</div>
        </div>
      </div>
    </div>
  </section>
</BaseLayout>
